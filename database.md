# Базы данных

## Доменное разделение

Мы не используем схему `public`.
Мы активно используем схемы для доменного разделения таблиц.
Схемы базы данных по доменному разделению должны повторять доменное разделение в самом приложении.
Иными словами, если в пакете `entity` у нас пакет `user` с классом `Person`, то и в базе данных таблица `persons` должна лежать в схеме `users`.

## Таблицы на основе внутренних ограничений

Все связи между таблицами и ссылки на них являются внутренними и генерируются базой данных.
Все ссылки между сущностями, полученные извне, являются не более чем бизнес-данными и не могут быть связями между таблицами в наших внутренних базах данных.
В силу вступает правило: если что-то зависит от чего-то, оно имеет право этим чем-то управлять.
Пример: если отдел кадров зависит от программного компонента, который, к примеру, считает отработанные часы по определённой формуле, отдел кадров может попросить эту формулу изменить по своему усмотрению.
Мы не можем управлять внешними связями.
Это значит, что мы не должны от них зависеть.
Для нас это просто бизнес-данные.

## Именования

Мы используем множества для именований там, где это возможно. `users`, `dictionaries`, `buffers` и так далее.

Если поле является ограничением (constraint), к нему применяются следующие правила именования:

| Тип ограничения   | Правило именования поля                 | Пример именования поля | Правило именования ограничения                            | Пример именования ограничения                                              |
|-------------------|-----------------------------------------|------------------------|-----------------------------------------------------------|----------------------------------------------------------------------------|
| Первичный ключ    | Имя внешней таблицы с постфиксом _`id`. | `user_id`              | Имя внешней таблицы с постфиксом `_pk`                    | `user_pk`                                                                  |
| Вторичный ключ    | Имя внешней таблицы с постфиксом _`id`. | `user_id`              | Имя внешней таблицы с постфиксом `_fk`                    | `user_fk`                                                                  |
| Простой индекс    |                                         |                        | Имя таблицы + имя поля с постфиксом `_idx`                | `user_name_idx`, `user_id_idx`, `user_name_type_idx` (для множества полей) |
| Уникальный индекс |                                         |                        | Имя таблицы + имя поля с постфиксом `_udx`                | `user_name_udx`, `user_id_udx`, `user_name_type_udx` (для множества полей) |
| Проверка (check)  |                                         |                        | Имя таблицы + имя поля + суть проверки с постфиксом `_ck` | `user_age_positive_ck` для `age` > 0                                       |